# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/interrupt-controller/loongson,ipi.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Loongson Inter-Processor Interrupt (IPI) Controller

maintainers:
  - Jiaxun Yang <jiaxun.yang@flygoat.com>

properties:
  compatible:
    oneOf:
      - const: loongson,ls2k-ipi
      - const: loongson,ls3a-ipi
      - const: loongson,csr-ipi
      - items:
          - const: loongson,ls3a-ipi
          - const: loongson,csr-ipi

  reg:
    minItems: 1
    maxItems: 16
    description: Specifies MMIO registers for each node of the IPI controller.
      Optional for the CSR-based IPI controller.

  interrupts-extended:
    minItems: 1
    maxItems: 4095

allOf:
  - if:
      properties:
        compatible:
          contains:
            const: loongson,ls2k-ipi
    then:
      properties:
        reg:
          maxItems: 1

  - if:
      not:
        properties:
          compatible:
            contains:
              const: loongson,csr-ipi
    then:
      required:
        - reg

required:
  - compatible
  - interrupts-extended

additionalProperties: false

examples:
  # Loongson-2K IPI controller
  - |
      cpuintc: interrupt-controller {
        #address-cells = <0>;
        #interrupt-cells = <1>;
        interrupt-controller;
        compatible = "mti,cpu-interrupt-controller";
      };

      ipi@3ff01000 {
        compatible = "loongson,ls2k-ipi";
        interrupts-extended = <&cpuintc 6>;
        reg = <0x1fe01000 0x1000>;
      };
  
  # Loongson-2K IPI controller with percpu cpuintc 
  - |
    / {
      	cpus {
          #address-cells = <1>;
          #size-cells = <0>;

          cpu0: cpu@0 {
            device_type = "cpu";
            compatible = "loongson,gs264";
            reg = <0x0>;
            cpu0intc: interrupt-controller {
              #address-cells = <0>;
              #interrupt-cells = <1>;
              interrupt-controller;
              compatible = "mti,cpu-interrupt-controller";
            };
          };

          cpu1: cpu@1 {
            device_type = "cpu";
            compatible = "loongson,gs264";
            reg = <0x1>;
            cpu1intc: interrupt-controller {
              #address-cells = <0>;
              #interrupt-cells = <1>;
              interrupt-controller;
              compatible = "mti,cpu-interrupt-controller";
            };
          };
        };

        ipi@3ff01000 {
          compatible = "loongson,ls2k-ipi";
          interrupts-extended = <&cpu0intc 6>, <&cpu1intc 6>;
          reg = <0x1fe01000 0x1000>;
        };
    };

  # 4 nodes Loongson-3A MMIO IPI controller
  - |
    / {
      #address-cells = <2>;
      #size-cells = <2>;

      ipi@3ff01000 {
        compatible = "loongson,ls3a-ipi";
        interrupts-extended = <&cpuintc 6>;
        reg = <0x0000000 0x3ff01000 0 0x1000>,
              <0x0001000 0x3ff01000 0 0x1000>,
              <0x0002000 0x3ff01000 0 0x1000>,
              <0x0003000 0x3ff01000 0 0x1000>;
      };
    };
  
  # 4 nodes Loongson-3A MMIO + CSR controller
  - |
    / {
      #address-cells = <2>;
      #size-cells = <2>;

      ipi@3ff01000 {
        compatible = "loongson,ls3a-ipi", "loongson,csr-ipi";
        interrupts-extended = <&cpuintc 6>;
        reg = <0x0000000 0x3ff01000 0 0x1000>,
              <0x0001000 0x3ff01000 0 0x1000>,
              <0x0002000 0x3ff01000 0 0x1000>,
              <0x0003000 0x3ff01000 0 0x1000>;
      };
    };

  # CSR only IPI controller
  - |
    / {
      #address-cells = <2>;
      #size-cells = <2>;

      ipi {
        compatible = "loongson,csr-ipi";
        interrupts-extended = <&cpuintc 6>;
      };
    };
